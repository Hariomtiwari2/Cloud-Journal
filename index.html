<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cloud Diary</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-indigo-100 to-purple-200 min-h-screen p-6">

<div class="max-w-3xl mx-auto">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-indigo-700">‚òÅ Cloud Diary</h1>
    <button id="loginBtn"
      class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow hover:bg-indigo-700">
      Login
    </button>
  </div>

  <!-- Editor -->
  <div class="bg-white p-6 rounded-xl shadow-lg mb-6">

    <div class="flex gap-2 mb-3">
      <button onclick="format('bold')" class="px-3 py-1 bg-gray-200 rounded">B</button>
      <button onclick="format('italic')" class="px-3 py-1 bg-gray-200 rounded italic">I</button>
      <button onclick="format('underline')" class="px-3 py-1 bg-gray-200 rounded underline">U</button>
    </div>

    <div id="editor"
      contenteditable="true"
      class="border p-4 rounded-lg min-h-[120px] focus:outline-none">
    </div>

    <button onclick="saveEntry()"
      class="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
      Save Entry
    </button>
  </div>

  <!-- Entries List -->
  <div id="entries" class="space-y-4"></div>

</div>

<script>
const API_URL = "https://rkqkyfrjl8.execute-api.ap-south-1.amazonaws.com/entries";
const COGNITO_DOMAIN = "https://your-domain.auth.ap-south-1.amazoncognito.com";
const CLIENT_ID = "YOUR_APP_CLIENT_ID";
const REDIRECT_URI = "http://localhost:5500/index.html";

let accessToken = null;

/* ---------- Login ---------- */

document.getElementById("loginBtn").onclick = () => {
  window.location.href =
    `${COGNITO_DOMAIN}/login?client_id=${CLIENT_ID}` +
    `&response_type=token&scope=email+openid+profile` +
    `&redirect_uri=${REDIRECT_URI}`;
};

/* ---------- Handle Token After Redirect ---------- */

window.onload = () => {
  const hash = window.location.hash;
  if (hash.includes("access_token")) {
    const params = new URLSearchParams(hash.substring(1));
    accessToken = params.get("access_token");
    localStorage.setItem("token", accessToken);
  } else {
    accessToken = localStorage.getItem("token");
  }

  if (accessToken) {
    loadEntries();
  }
};

/* ---------- Rich Text ---------- */

function format(command) {
  document.execCommand(command, false, null);
}

/* ---------- Save Entry ---------- */

async function saveEntry() {
  const content = document.getElementById("editor").innerHTML;

  const response = await fetch(API_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + accessToken
    },
    body: JSON.stringify({ content })
  });

  document.getElementById("editor").innerHTML = "";
  loadEntries();
}

/* ---------- Load Entries ---------- */

async function loadEntries() {
  const response = await fetch(API_URL, {
    headers: {
      "Authorization": "Bearer " + accessToken
    }
  });

  const data = await response.json();
  const container = document.getElementById("entries");
  container.innerHTML = "";

  data.forEach(entry => {
    const div = document.createElement("div");
    div.className = "bg-white p-4 rounded-lg shadow";

    div.innerHTML = `
      <div class="mb-2">${entry.Content || entry.content}</div>
      <button onclick="deleteEntry('${entry.EntryID}')"
        class="text-red-500 hover:underline">Delete</button>
    `;

    container.appendChild(div);
  });
}

/* ---------- Delete Entry ---------- */

async function deleteEntry(id) {
  await fetch(`${API_URL}/${id}`, {
    method: "DELETE",
    headers: {
      "Authorization": "Bearer " + accessToken
    }
  });

  loadEntries();
}

</script>
</body>
</html>
