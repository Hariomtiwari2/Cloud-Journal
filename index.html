<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cloud Diary</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body id="body"
class="bg-gradient-to-br from-blue-100 to-purple-200 min-h-screen transition-all duration-500">

<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

<!-- Header -->
<div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-8">
  <h1 id="title" class="text-3xl sm:text-4xl font-bold text-indigo-700 text-center sm:text-left">
    ‚òÅ Cloud Diary
  </h1>

  <button id="themeBtn"
    onclick="toggleTheme()"
    class="px-5 py-2 bg-gray-800 text-white rounded-lg transition-all duration-300">
    üåô Night
  </button>
</div>

<!-- Editor Card -->
<div id="card"
  class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl transition-all duration-500">

  <!-- Formatting -->
  <div class="flex flex-wrap gap-3 mb-4">
    <button onclick="format('bold')" class="px-4 py-2 bg-gray-200 rounded font-bold">B</button>
    <button onclick="format('italic')" class="px-4 py-2 bg-gray-200 rounded italic">I</button>
    <button onclick="format('underline')" class="px-4 py-2 bg-gray-200 rounded underline">U</button>
  </div>

  <!-- Writing Space -->
  <div id="editor"
    contenteditable="true"
    class="border-2 border-gray-200 p-6 rounded-xl min-h-[250px] sm:min-h-[350px] lg:min-h-[450px] text-lg focus:outline-none focus:border-indigo-400 transition-all">
  </div>

  <button onclick="saveEntry()"
    class="mt-6 w-full sm:w-auto bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-all">
    Save Entry
  </button>
</div>

<!-- Entries -->
<div id="entries" class="mt-10 space-y-6"></div>

</div>

<script>
const API_URL = "https://rkqkyfrjl8.execute-api.ap-south-1.amazonaws.com/entries";
let accessToken = localStorage.getItem("token");
let isDark = false;

/* THEME */
function toggleTheme() {
  const body = document.getElementById("body");
  const card = document.getElementById("card");
  const title = document.getElementById("title");
  const btn = document.getElementById("themeBtn");

  if (!isDark) {
    body.className =
      "bg-gradient-to-br from-gray-900 to-black text-white min-h-screen transition-all duration-500";
    card.className =
      "bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-xl transition-all duration-500";
    title.className = "text-3xl sm:text-4xl font-bold text-white";
    btn.innerHTML = "‚òÄÔ∏è Day";
    btn.className =
      "px-5 py-2 bg-yellow-500 text-black rounded-lg transition-all duration-300";
    isDark = true;
  } else {
    body.className =
      "bg-gradient-to-br from-blue-100 to-purple-200 min-h-screen transition-all duration-500";
    card.className =
      "bg-white p-6 sm:p-8 rounded-2xl shadow-xl transition-all duration-500";
    title.className = "text-3xl sm:text-4xl font-bold text-indigo-700";
    btn.innerHTML = "üåô Night";
    btn.className =
      "px-5 py-2 bg-gray-800 text-white rounded-lg transition-all duration-300";
    isDark = false;
  }
}

/* Text Formatting */
function format(cmd) {
  document.execCommand(cmd, false, null);
}

/* Save Entry */
async function saveEntry() {
  const content = document.getElementById("editor").innerHTML;

  await fetch(API_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + accessToken
    },
    body: JSON.stringify({ content })
  });

  document.getElementById("editor").innerHTML = "";
  loadEntries();
}

/* Load Entries */
async function loadEntries() {
  const response = await fetch(API_URL, {
    headers: { "Authorization": "Bearer " + accessToken }
  });

  const data = await response.json();
  const container = document.getElementById("entries");
  container.innerHTML = "";

  data.forEach(entry => {
    const div = document.createElement("div");
    div.className =
      "bg-white p-6 rounded-xl shadow-md transition-all hover:scale-[1.02]";

    div.innerHTML = `
      <div class="mb-3 text-lg">${entry.Content || entry.content}</div>
      <button onclick="deleteEntry('${entry.EntryID}')"
        class="text-red-500 hover:underline">Delete</button>
    `;

    container.appendChild(div);
  });
}

/* Delete */
async function deleteEntry(id) {
  await fetch(`${API_URL}/${id}`, {
    method: "DELETE",
    headers: {
      "Authorization": "Bearer " + accessToken
    }
  });
  loadEntries();
}

if (accessToken) loadEntries();
</script>

</body>
</html>
